---
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Tutorial — AsyncAPI</title>
    <meta charset="utf-8">
    <meta name="description" content="Define your Message-Driven APIs">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="alternate" hreflang="x-default" href="https://asyncapi.org/v1/tutorial/index.html">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Tutorial — AsyncAPI">
    <meta property="og:description" content="Define your Message-Driven APIs">
    <meta property="og:image" content="https://www.asyncapi.com//images/twitter-card-image.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Tutorial — AsyncAPI">
    <meta name="twitter:description" content="Define your Message-Driven APIs">
    <meta name="twitter:image" content="https://www.asyncapi.com/images/twitter-card-image.png">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Dosis:500' rel='stylesheet' type='text/css'>

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- this needs to be loaded before guide's inline scripts -->
    <script>window.PAGE_TYPE = "tutorial"</script>

    <!-- ga -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-109278936-1', 'www.asyncapi.com');
      ga('send', 'pageview');
    </script>
  </head>
  <body class="docs">    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>
    <div id="header">
  <a id="logo" href="/">
    <img src="/images/logo.png">
    <span>AsyncAPI</span>
  </a>
  <ul id="nav">
    <li class="nav-dropdown-container learn">
  <a class="nav-link current">
    Learn
    <span class="arrow"></span>
  </a>
  <ul class="nav-dropdown">
    <li><ul>
      <li><a href="/v1/guide/" class="nav-link">Guide</a></li>
      <li><a href="/v1/tutorial/" class="nav-link current">Tutorial</a></li>
      <li><a href="/v1/spec.html" class="nav-link">The specification</a></li>
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
      <li><a href="https://github.com/asyncapi/asyncapi " class="nav-link" target="_blank">Github repo</a></li>
      <li><a href="https://async-apis-slack.herokuapp.com/ " class="nav-link" target="_blank">Slack channel</a></li>
    </ul></li>
    <li><h4>Tooling</h4></li>
    <li>
      <ul>
        <li><a href="http://editor.asyncapi.org" class="nav-link" target="_blank">Online editor</a></li>
        <li><a href="/v1/tooling/docgens.html" class="nav-link ">Documentation generators</a></li>
        <li><a href="/v1/tooling/codegens.html" class="nav-link ">Code generators</a></li>
      </ul>
    </li>
    <li><h4>News</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/search?q=asyncapi" class="nav-link" target="_blank">Twitter</a></li>
      <li><a href="https://medium.com/asyncapi" class="nav-link" target="_blank">Blog</a></li>
    </ul></li>
    <li><h4>Spread the word</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwww.asyncapi.org&via=fmvilas&text=Check%20out%20%23AsyncAPI.%20Worth%20having%20a%20look%21&hashtags=api%2Cmicroservices%2Ctech%2Ccode" class="nav-link" target="_blank">Tweet about it</a></li>
    </ul></li>
  </ul>
</li>

<li>
  <a href="/about.html" class="nav-link about">About</a>
</li>

  </ul>
</div>


      <div id="main" class="fix-sidebar">


  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li class="nav-dropdown-container learn">
  <a class="nav-link current">
    Learn
    <span class="arrow"></span>
  </a>
  <ul class="nav-dropdown">
    <li><ul>
      <li><a href="/v1/guide/" class="nav-link">Guide</a></li>
      <li><a href="/v1/tutorial/" class="nav-link current">Tutorial</a></li>
      <li><a href="/v1/spec.html" class="nav-link">The specification</a></li>
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
      <li><a href="https://github.com/asyncapi/asyncapi " class="nav-link" target="_blank">Github repo</a></li>
      <li><a href="https://async-apis-slack.herokuapp.com/ " class="nav-link" target="_blank">Slack channel</a></li>
    </ul></li>
    <li><h4>Tooling</h4></li>
    <li>
      <ul>
        <li><a href="http://editor.asyncapi.org" class="nav-link" target="_blank">Online editor</a></li>
        <li><a href="/v1/tooling/docgens.html" class="nav-link ">Documentation generators</a></li>
        <li><a href="/v1/tooling/codegens.html" class="nav-link ">Code generators</a></li>
      </ul>
    </li>
    <li><h4>News</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/search?q=asyncapi" class="nav-link" target="_blank">Twitter</a></li>
      <li><a href="https://medium.com/asyncapi" class="nav-link" target="_blank">Blog</a></li>
    </ul></li>
    <li><h4>Spread the word</h4></li>
    <li><ul>
      <li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwww.asyncapi.org&via=fmvilas&text=Check%20out%20%23AsyncAPI.%20Worth%20having%20a%20look%21&hashtags=api%2Cmicroservices%2Ctech%2Ccode" class="nav-link" target="_blank">Tweet about it</a></li>
    </ul></li>
  </ul>
</li>

<li>
  <a href="/about.html" class="nav-link about">About</a>
</li>

    </ul>
    <div class="list">
      <ul class="menu-root">



    <li>
      <a href="/v1/tutorial/index.html" class="sidebar-link current">Tutorial</a>
    </li>

</ul>

    </div>
  </div>
</div>


<div class="content tutorial with-sidebar ">




    <h1>Tutorial</h1>

  <p>In this tutorial I want to help you get started with actual code and a (could-be) real world use case. Let’s pretend we have a company called Smarty Lighting and we do smart-city lighting systems.</p>
<h2 id="System-Description"><a href="#System-Description" class="headerlink" title="System Description"></a>System Description</h2><p>We want to create a system capable of turning on/off the streetlights depending on the environmental conditions of each of them:</p>
<ul>
<li>We’re going to implement a message-driven architecture, with a Message Broker in its “center”.</li>
<li>Streetlights will send information about its environmental lighting to the broker.</li>
<li>None of the services will wait for any kind of response. Think about it as fire and forget. We’ll publish messages to the broker and that’s it. Our service don’t know who will receive them.</li>
</ul>
<h2 id="Technology"><a href="#Technology" class="headerlink" title="Technology"></a>Technology</h2><p>We’ll use Node.js to code our APIs and Mosquitto as our message broker. Please note this is just my choice for the tutorial but what is going to be explained here is applicable to any other programming language and other message brokers.</p>
<h2 id="The-AsyncAPI-file"><a href="#The-AsyncAPI-file" class="headerlink" title="The AsyncAPI file"></a>The AsyncAPI file</h2><p>Let’s start by creating an AsyncAPI file to describe our API. It will help us generate the code and the documentation later.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">asyncapi:</span> <span class="string">'1.0.0'</span></div><div class="line"><span class="attr">info:</span></div><div class="line"><span class="attr">  title:</span> <span class="string">Streetlights</span> <span class="string">API</span></div><div class="line"><span class="attr">  version:</span> <span class="string">'1.0.0'</span></div><div class="line"><span class="attr">  description:</span> <span class="string">|</span></div><div class="line"><span class="string">    The Smartylighting Streetlights API allows you</span></div><div class="line"><span class="string">    to remotely manage the city lights.</span></div><div class="line"><span class="string"></span><span class="attr">  license:</span></div><div class="line"><span class="attr">    name:</span> <span class="string">Apache</span> <span class="number">2.0</span></div><div class="line"><span class="attr">    url:</span> <span class="string">'https://www.apache.org/licenses/LICENSE-2.0'</span></div><div class="line"><span class="attr">baseTopic:</span> <span class="string">smartylighting.streetlights.1.0</span></div><div class="line"></div><div class="line"><span class="attr">servers:</span></div><div class="line"><span class="attr">  - url:</span> <span class="string">api.streetlights.smartylighting.com:&#123;port&#125;</span></div><div class="line"><span class="attr">    scheme:</span> <span class="string">mqtt</span></div><div class="line"><span class="attr">    description:</span> <span class="string">Test</span> <span class="string">broker</span></div><div class="line"><span class="attr">    variables:</span></div><div class="line"><span class="attr">      port:</span></div><div class="line"><span class="attr">        description:</span> <span class="string">Secure</span> <span class="string">connection</span> <span class="string">(TLS)</span> <span class="string">is</span> <span class="string">available</span> <span class="string">through</span> <span class="string">port</span> <span class="number">8883.</span></div><div class="line"><span class="attr">        default:</span> <span class="string">'1883'</span></div><div class="line"><span class="attr">        enum:</span></div><div class="line"><span class="bullet">          -</span> <span class="string">'1883'</span></div><div class="line"><span class="bullet">          -</span> <span class="string">'8883'</span></div><div class="line"></div><div class="line"><span class="attr">topics:</span></div><div class="line">  <span class="string">event.&#123;streetlightId&#125;.lighting.measured:</span></div><div class="line"><span class="attr">    publish:</span></div><div class="line">      <span class="string">$ref:</span> <span class="string">'#/components/messages/lightMeasured'</span></div><div class="line"></div><div class="line"><span class="attr">components:</span></div><div class="line"><span class="attr">  messages:</span></div><div class="line"><span class="attr">    lightMeasured:</span></div><div class="line"><span class="attr">      summary:</span> <span class="string">Inform</span> <span class="string">about</span> <span class="string">environmental</span> <span class="string">lighting</span> <span class="string">conditions</span> <span class="string">for</span> <span class="string">a</span> <span class="string">particular</span> <span class="string">streetlight.</span></div><div class="line"><span class="attr">      payload:</span></div><div class="line">        <span class="string">$ref:</span> <span class="string">"#/components/schemas/lightMeasuredPayload"</span></div><div class="line"></div><div class="line"><span class="attr">  schemas:</span></div><div class="line"><span class="attr">    lightMeasuredPayload:</span></div><div class="line"><span class="attr">      type:</span> <span class="string">object</span></div><div class="line"><span class="attr">      properties:</span></div><div class="line"><span class="attr">        lumens:</span></div><div class="line"><span class="attr">          type:</span> <span class="string">integer</span></div><div class="line"><span class="attr">          minimum:</span> <span class="number">0</span></div><div class="line"><span class="attr">          description:</span> <span class="string">Light</span> <span class="string">intensity</span> <span class="string">measured</span> <span class="string">in</span> <span class="string">lumens.</span></div><div class="line"><span class="attr">        sentAt:</span></div><div class="line">          <span class="string">$ref:</span> <span class="string">"#/components/schemas/sentAt"</span></div><div class="line"><span class="attr">    sentAt:</span></div><div class="line"><span class="attr">      type:</span> <span class="string">string</span></div><div class="line"><span class="attr">      format:</span> <span class="string">date-time</span></div><div class="line"><span class="attr">      description:</span> <span class="string">Date</span> <span class="string">and</span> <span class="string">time</span> <span class="string">when</span> <span class="string">the</span> <span class="string">message</span> <span class="string">was</span> <span class="string">sent.</span></div></pre></td></tr></table></figure>
<p>Let’s break it down into pieces:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">asyncapi:</span> <span class="string">'1.0.0'</span></div><div class="line"><span class="attr">  info:</span></div><div class="line"><span class="attr">    title:</span> <span class="string">Streetlights</span> <span class="string">API</span></div><div class="line"><span class="attr">    version:</span> <span class="string">'1.0.0'</span></div><div class="line"><span class="attr">    description:</span> <span class="string">|</span></div><div class="line"><span class="string">      The Smartylighting Streetlights API allows you</span></div><div class="line"><span class="string">      to remotely manage the city lights.</span></div><div class="line"><span class="string"></span><span class="attr">    license:</span></div><div class="line"><span class="attr">      name:</span> <span class="string">Apache</span> <span class="number">2.0</span></div><div class="line"><span class="attr">      url:</span> <span class="string">'https://www.apache.org/licenses/LICENSE-2.0'</span></div><div class="line"><span class="attr">  baseTopic:</span> <span class="string">smartylighting.streetlights.1.0</span></div></pre></td></tr></table></figure>
<ul>
<li>The <code>asyncapi</code> field indicates we want to use AsyncAPI version 1.0.0.</li>
<li>Inside the <code>info</code> field we can find information about the API, like its name, version, a description and its license.</li>
<li>The <code>baseTopic</code> field is a string that will be prepended to the topics we’ll be defining afterwards. It is optional.</li>
</ul>
<p>We’re now going for the topics section. It is used to describe the event names or action names your API will be publishing and/or subscribing to.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">topics:</span></div><div class="line">  <span class="string">event.&#123;streetlightId&#125;.lighting.measured:</span></div><div class="line"><span class="attr">    publish:</span></div><div class="line">      <span class="string">$ref:</span> <span class="string">'#/components/messages/lightMeasured'</span></div></pre></td></tr></table></figure>
<p>Here <code>event.{streetlightId}.lighting.measured</code> is the topic name your API will allow you to publish to. The <code>{streetlightId}</code> part is a variable and it means you can actually specify whatever there. Remember the baseTopic we mentioned before? Well, it means that your API will actually be subscribed to <code>smartylighting.streetlights.1.0.event.{streetlightId}.lighting.measured</code>, but to avoid repeating the first part in every topic we decided to move it to the baseTopic field.</p>
<p>Something we should take into account when we see <code>$ref: &#39;#/components/messages/turnOnOff&#39;</code> is that <code>$ref</code> references a URL. This means that <code>#</code> refers to our document (like in websites), but it could be a URL pointing to an external file.</p>
<p>Next up is our components section:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">components:</span></div><div class="line"><span class="attr">  messages:</span></div><div class="line">    <span class="string">...</span></div><div class="line"></div><div class="line"><span class="attr">  schemas:</span></div><div class="line">    <span class="string">...</span></div></pre></td></tr></table></figure>
<p>The components section can contain messages, schemas and security schemes - we’re not using security schemes for simplicity. In the messages subsection we’ll define how our messages will look like and, in the schemas section, we’ll put reusable pieces of the data the messages will contain.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">components:</span></div><div class="line"><span class="attr">  messages:</span></div><div class="line"><span class="attr">    lightMeasured:</span></div><div class="line"><span class="attr">      summary:</span> <span class="string">Inform</span> <span class="string">about</span> <span class="string">environmental</span> <span class="string">lighting</span> <span class="string">conditions</span> <span class="string">for</span> <span class="string">a</span> <span class="string">particular</span> <span class="string">streetlight.</span></div><div class="line"><span class="attr">      payload:</span></div><div class="line">        <span class="string">$ref:</span> <span class="string">"#/components/schemas/lightMeasuredPayload"</span></div></pre></td></tr></table></figure>
<p>Here we’re describing the a message that we’re going to use for our example. A message can contain a summary, a description, a payload, etc. <a href="https://github.com/asyncapi/asyncapi#messageObject" target="_blank" rel="external">Learn more here.</a></p>
<p>Let’s pay special attention to the payload attribute, which references a schema defining how the message data is structured.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">components:</span></div><div class="line"><span class="attr">  schemas:</span></div><div class="line"><span class="attr">    lightMeasuredPayload:</span></div><div class="line"><span class="attr">      type:</span> <span class="string">object</span></div><div class="line"><span class="attr">      properties:</span></div><div class="line"><span class="attr">        lumens:</span></div><div class="line"><span class="attr">          type:</span> <span class="string">integer</span></div><div class="line"><span class="attr">          minimum:</span> <span class="number">0</span></div><div class="line"><span class="attr">          description:</span> <span class="string">Light</span> <span class="string">intensity</span> <span class="string">measured</span> <span class="string">in</span> <span class="string">lumens.</span></div><div class="line"><span class="attr">        sentAt:</span></div><div class="line">          <span class="string">$ref:</span> <span class="string">"#/components/schemas/sentAt"</span></div><div class="line"><span class="attr">    sentAt:</span></div><div class="line"><span class="attr">      type:</span> <span class="string">string</span></div><div class="line"><span class="attr">      format:</span> <span class="string">date-time</span></div><div class="line"><span class="attr">      description:</span> <span class="string">Date</span> <span class="string">and</span> <span class="string">time</span> <span class="string">when</span> <span class="string">the</span> <span class="string">message</span> <span class="string">was</span> <span class="string">sent.</span></div></pre></td></tr></table></figure>
<p>It will be an object containing 2 properties: lumens and sentAt. The former is a number describing the light intensity and the second is a date-time string indicating when the message was sent. We can describe much more things using the JSON schema syntax, <a href="https://github.com/asyncapi/asyncapi#schemaObject" target="_blank" rel="external">check out here</a>.</p>
<p>Cool! So we’re done with our AsyncAPI file!</p>
<h2 id="Generating-code"><a href="#Generating-code" class="headerlink" title="Generating code"></a>Generating code</h2><p>To generate our code we’ll use the <a href="https://www.npmjs.com/package/asyncapi-node-codegen" target="_blank" rel="external">AsyncAPI Node.js code generator</a>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm install -g asyncapi-node-codegen</div></pre></td></tr></table></figure>
<p>(You might need to use sudo)</p>
<p>Create a directory for your projects and step into it:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">mkdir streetlights &amp;&amp; <span class="built_in">cd</span> <span class="string">"<span class="variable">$_</span>"</span></div></pre></td></tr></table></figure>
<p>Create a file with the AsyncAPI machine-readable description we created before:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">touch asyncapi.yml</div><div class="line"><span class="comment"># Open asyncapi.yml and paste the definition</span></div></pre></td></tr></table></figure>
<p>And now let’s generate the code for it:<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">asyncapi-node-codegen asyncapi.yml .</div></pre></td></tr></table></figure></p>
<p>And voilà!</p>
<h2 id="Running-our-code"><a href="#Running-our-code" class="headerlink" title="Running our code"></a>Running our code</h2><p>Before running your code don’t forget to install the dependencies on every project:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm install</div></pre></td></tr></table></figure>
<p>Then go to <code>config/common.yml</code> and change the default mqtt host to <code>mqtt://test.mosquitto.org</code> and default mqtt topics to <code>smartylighting/streetlights/1/0/event/#</code>.</p>
<p>Finally you can run the code by simply running <code>npm start</code>.</p>
<p>Now that you have your code running you’ll want to test it, right? Go and install the mqtt library:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm install mqtt -g</div></pre></td></tr></table></figure>
<p>(You might need to use sudo)</p>
<p>Try to send messages to your service using the command line:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">mqtt pub -t <span class="string">'smartylighting/streetlights/1/0/event/farolina/lighting/measured'</span> -h <span class="string">'test.mosquitto.org'</span> -m <span class="string">'&#123;"lumens": 3, "sentAt": "2017-06-07T12:34:32.000Z"&#125;'</span></div></pre></td></tr></table></figure>
<p>You should see our application logging the message you just sent.</p>
<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h2><p>We’ve learned how to create an AsyncAPI description file and how to generate code from it. The code is just a bootstrap and you’ll need to add your business logic into it. Take some time to play with it.<br>There are still lots of things to be covered but I kept the tutorial simple on purpose, so you get an idea of the potential.</p>
<p>We would also like to see what you create with AsyncAPI. As an open-source project we’re open to proposals, questions, suggestions and contributions. If you don’t feel in the mood to contribute but you’re using AsyncAPI, just raise your hand <a href="https://github.com/asyncapi/asyncapi/issues/new" target="_blank" rel="external">creating a issue in our Github repo</a> or <a href="https://async-apis-slack.herokuapp.com/" target="_blank" rel="external">join our Slack channel</a>. Don’t be shy :)</p>


  {% include footer.html %}
</div>


      </div>
      <script src="/js/smooth-scroll.min.js"></script>


    <!-- main custom script for sidebars, version selects etc. -->
    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>

    <!-- fastclick -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      FastClick.attach(document.body)
    }, false)
    </script>
  </body>
</html>
